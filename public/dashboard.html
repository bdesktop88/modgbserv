<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Redirect Dashboard</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    table { width: 100%; border-collapse: collapse; }
    th, td { border: 1px solid #ccc; padding: 8px; }
    th { background-color: #f0f0f0; }
    button { padding: 5px 10px; margin: 2px; }
    input[type="text"] { width: 100%; padding: 5px; }
  </style>
</head>
<body>
  <h1>Redirect Dashboard</h1>
  <table>
    <thead>
      <tr>
        <th>Key</th>
        <th>Destination</th>
        <th>Token</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody id="redirectTable"></tbody>
  </table>

  <script>
    async function fetchRedirects() {
      const res = await fetch('/api/redirects');
      const data = await res.json();
      const tbody = document.getElementById('redirectTable');
      tbody.innerHTML = '';

      data.forEach(r => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${r.key}</td>
          <td>
            <input type="text" value="${r.destination}" id="dest-${r._id}">
          </td>
          <td>${r.token}</td>
          <td>
            <button onclick="updateRedirect('${r._id}')">Update</button>
            <button onclick="deleteRedirect('${r._id}')">Delete</button>
          </td>
        `;
        tbody.appendChild(row);
      });
    }

    async function updateRedirect(id) {
      const newDestination = document.getElementById(`dest-${id}`).value;
      const res = await fetch(`/api/redirects/${id}`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ destination: newDestination })
      });

      if (res.ok) {
        alert('Updated!');
        fetchRedirects();
      } else {
        alert('Update failed');
      }
    }

    async function deleteRedirect(id) {
      if (!confirm('Are you sure you want to delete this redirect?')) return;
      const res = await fetch(`/api/redirects/${id}`, { method: 'DELETE' });
      if (res.ok) {
        alert('Deleted!');
        fetchRedirects();
      } else {
        alert('Delete failed');
      }
    }

    fetchRedirects();
  </script>
</body>
</html>
